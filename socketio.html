<!DOCTYPE html>
<html>
  <head>
    <script
      src="https://cdn.socket.io/4.5.3/socket.io.min.js"
      integrity="sha384-WPFUvHkB1aHA5TDSZi6xtDgkF0wXJcIIxXhC6h8OT8EH3fC5PWro5pWJ1THjcfEi"
      crossorigin="anonymous"
    ></script>
    <script>
      var socket = io("http://localhost:4000", {});

      socket.on("welcome", function (data) {
        addMessage(data.message);

        // Respond with a message including this clients' id sent from the server
        socket.emit("i am client", { data: "foo!", id: data.id });
      });
      socket.on("time", function (data) {
        addMessage(data.time);
      });
      socket.onAny((eventName, ...args) => {
        console.log(eventName, args);
        if (eventName === "fdmmonster") {
          addMessage(eventName, JSON.parse(args));
        } else if (eventName === "event") {
          addMessage("OP-WS", JSON.parse(args[0])?.type);
        }
      });
      socket.on("error", console.error.bind(console));

      // socket.on("message", console.log.bind(console));

      function addMessage(eventName, message) {
        const text = document.createTextNode(`${eventName} - ${message}`);
        const el = document.createElement("li");
        const messages = document.getElementById("messages");

        el.appendChild(text);
        messages.appendChild(el);
      }

      function requestPrinter() {
        socket.emit("request");
      }
    </script>
  </head>
  <body>
    <button onclick="requestPrinter()">request</button>
    <ul id="messages"></ul>
  </body>
</html>
